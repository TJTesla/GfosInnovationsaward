<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:k="http://xmlns.jcp.org/jsf/passthrough">
<f:metadata>
    <f:viewAction action="#{indexController.isEmployee()}" />
</f:metadata>
<h:head>
    <title>Entwürfe Angebote</title>
</h:head>
<h:body>
    <ui:composition template="../resources/templates/common.xhtml">
        <ui:define name="content">
            <h:outputStylesheet library="css" name="index.css" />
            <h:outputStylesheet library="css" name="offer.css" />
            <h:outputScript library="javascript" name="index.js" />
            <div align="center" class="drafts-title">
                <h2>Entwürfe</h2>
                <hr />
            </div>
            <div class="wrapper">
                <h:form>
                    <!-- Filter bar -->
                    <div class="filter">
                        <!-- Dropdown: Field of Profession -->
                        <div class="dropdown">
                            <button class="dropbtn ui-button" id="dropbtnField" type="button">Berufsfeld <i class="pi pi-caret-down" /></button>
                            <div class="navContent" id="dropdownField">
                                <ui:repeat id="field" var="f" value="#{indexController.allFields}">
                                    <div class="a">
                                        <h:selectBooleanCheckbox styleClass="checkBox" value="#{indexController.field[f.first()]}" />
                                        <h:outputLabel styleClass="checkLabel" value="#{f.second()}" />
                                    </div>
                                </ui:repeat>
                            </div>
                        </div>

                        <!-- Dropdown: Level of Education -->
                        <div class="dropdown">
                            <button class="dropbtn ui-button" id="dropbtnLevel" type="button">Einstiegniveau <i class="pi pi-caret-down" /></button>
                            <div class="navContent" id="dropdownLevel">
                                <ui:repeat id="level" var="l" value="#{indexController.allLevels}" varStatus="">
                                    <div class="a">
                                        <h:selectBooleanCheckbox styleClass="checkBox" value="#{indexController.level[l.first()]}" />
                                        <h:outputLabel styleClass="checkLabel" value="#{l.second()}" />
                                    </div>
                                </ui:repeat>
                            </div>
                        </div>

                        <!-- Dropdown: Working Time -->
                        <div class="dropdown">
                            <button class="dropbtn ui-button" id="dropbtnTime" type="button">Arbeitszeit <i class="pi pi-caret-down" /></button>
                            <div class="navContent" id="dropdownTime">
                                <ui:repeat id="time" var="t" value="#{indexController.allTimes}" varStatus="">
                                    <div class="a">
                                        <h:selectBooleanCheckbox styleClass="checkBox" value="#{indexController.time[t.first()]}" />
                                        <h:outputLabel styleClass="checkLabel" value="#{t.second()}" />
                                    </div>
                                </ui:repeat>
                            </div>
                        </div>
                    </div>

                    <!-- Button for application -->
                    <div class="applyBtn">
                        <h:commandButton value="Anwenden" action="#{indexController.reload()}" styleClass="navBtn ui-button" />
                        <c:if test="#{indexController.loggedInAsEmployee()}" >
                            <h:button value="Neues Angebot erstellen" outcome="/02-offer/createOffer.xhtml" styleClass="btn-newOffer ui-button" />
                        </c:if>
                    </div>
                </h:form>


                <!-- List of Drafts -->
                <div class="offers" id="offers">
                    <div class="border-line"> </div>
                    <ui:repeat id="offers" var="offer" value="#{indexController.allOfferDrafts}" varStatus="statusCount">
                        <div class="allOffers">
                            <h:form>
                                <div class="offer-left">
                                    <!-- Offer: Title -->
                                    <h:outputLabel id="title" value="#{offer.title}" styleClass="offer-label" />
                                    <br />
                                    <!-- Offer: Location -->
                                    <div class="offer-attr">
                                        <i class="pi pi-map-marker">&nbsp;</i>
                                        <h:outputText id="location" value="#{offer.city}" styleClass="offer-location" />
                                    </div>
                                    <!-- Offer: Field of profession -->
                                    <div class="offer-attr">
                                        <i class="pi pi-briefcase">&nbsp;</i>
                                        <h:outputText id="field" value="#{indexController.fieldString(offer.field)}" styleClass="offer-field" />
                                    </div>
                                </div>
                                <!-- Button for Deletion -->
                                <div class="offer-btn">
                                    <p:commandButton id="deleteDraft"  styleClass="btn-delete" value="" icon="pi pi-trash" ajax="true" onclick="showPopUp(#{statusCount.index})" />
                                    <p:button outcome="/02-offer/offer" styleClass="btn-toOffer" value="" icon="pi pi-angle-right">
                                        <f:param name="id" value="#{offer.id}" />
                                    </p:button>
                                </div>
                            </h:form>
                        </div>
                        <!-- Popup for deletion -->
                        <div class="cover" id="popup#{statusCount.index}">
                            <div class="popup">
                                <h:form>
                                    <h:outputText id="question" value="Sind Sie sich sicher, dass Sie diesen Entwurf löschen möchten?" style="display: block;" />
                                    <h:outputText id="questionTitle" value="#{offer.title}" style="display: block; font-style: italic" />
                                    <div class="wrap-btns">
                                        <h:commandButton value="Abbrechen" id="cancel" styleClass="btn-cancel ui-button" onclick="hidePopUp(#{statusCount.index})">
                                            <f:ajax render="@none" />
                                        </h:commandButton>
                                        <h:commandButton value="Löschen" id="delete" styleClass="btn-deleteFinal ui-button" onclick="hidePopUp(#{statusCount.index})" action="#{indexController.delete(offer)}" ajax="false" />
                                    </div>
                                </h:form>
                            </div>
                        </div>
                    </ui:repeat>
                </div>
            </div>
        </ui:define>
    </ui:composition>
</h:body>
</html>